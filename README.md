# Репозиторий для конкурса Университета ИИ "Распознование Джима Керри в видео фрагменте".

Данный репозиторий содержит 2 независимых файла с решением конкурсного задания:
1
NU_Competition_Jim_Complite_1_2_.ipynb

2
NU_Competition_Jim_Complite_2_2_.ipynb

Логика выполнения кода:
1) Указать в переменной pathVideo, путь до анализируемого видео файла.
2) Выполнить все скрипты последовательно.

# Результаты

Результаты скрипта **NU_Competition_Jim_Complite_1_2_.ipynb**
- Хронометраж с Джимом - 3 мин. 46 секунд.
- Ссылка на ролик по итогам работы модели и кода:
https://cloud.mail.ru/public/rGwQ/Z8dsNG9L1
- Срок работы кода, примерно 1 час на тестовом видео фрагменте.
- Итоговые используемые технологии:
haarCascade + Face_recognition (dlib) от Adam Geitgey.
- Ссылка на Colab:
https://colab.research.google.com/drive/1HvpBALuBHmOLCDvt9hF-ktEdlRp93j1R?usp=sharing

Результаты скрипта **NU_Competition_Jim_Complite_2_2_.ipynb**
- Хронометраж с Джимом - 5 минут 57 секунд
- Ссылка на ролик по итогам работы модели и кода:
https://cloud.mail.ru/public/dGqB/SrcqJc8Sb
- Срок работы кода, примерно 1 час 10 минут на тестовом видео фрагменте.
- Итоговые используемые технологии:
haarCascade + CNN модель
- Ссылка на Colab:
https://colab.research.google.com/drive/1aIKxvT8kwwoHcpGeZgLGnechOssRb7nb?usp=sharing
- Ссылка на модель h5, в GitHub не пролазит по ограничениям в размере 25 мб:
https://cloud.mail.ru/public/KxtK/QehkjBCEn

# **Логика решения задачи:**

- Создание видео фрагмента в видео редакторе. 
Видео фрагмент должен быть короткий, для скорости тестировани.
Должен быть с множеством лиц в одном кадре
Должен быть с разными ситуациями и эмоциями Джима, для качества тестирования.

- Покадровый анализ видео потока. Анализ изображения на Фейсдетект.
- Вырезание каждого фейса в отдельный клип. Складываени всех фейсов в один массив.
- Анализ каждого найденого фейса. Фейс Рекогнишен.
- Индикация клипов с фейсами и выделение кадра из видео, где есть Джим.
- Сохранение номеров изображений с Джимом для последующей склейки.
- Суммирование количества изображений из видео от УИИ. Определение общего хронометража с фейсами Джима Керри.
- Склейка и компиляция видео файла с фейсами Джима Керри.

# **Нюансы сравнения**
- Найти 10-15 изображений Джима керри для сравнения с ними.
- Оптимизировать изображения для ускорения работы кода (размер, сжатие изображения, поворот головы в вертикальное положение).
- Провести тестиривание на выборке, определить, какие изображения дают наиболее точные результаты в сравнении.
- Оставить только 1 изображения для сравнения, чтобы оптимизировать работу кода.

# **Оптимизация сжатия**
- Определяем оптимальное сжатие исходного кадра чтобы лица были различимы и скорость была оптимальной.
- При х4 сжатии видит только 220 лиц на тестовом периоде.
- При х2 сжатии видит 528 лиц на тестовом периоде.
- При х1 сжатии видит 880 лиц на тестовом периоде, 1 мин 36 секунд, весь ролик будет обрабатываться 1 час примерно, ТОЛЬКО на ФЕС ДЕТЕКШЕН!
Скороть падает пропорционально.
ПС: Сжатие дало негативный результат по качеству.

# **Особенности сбора базы**
- Особенностью решения данной задачи является, что Джим Керри, отличный актер и играет лицом очень изменчиво, что является повышенной сложностью задачи для Нейронки.
В интернете на всех фотграфиях Джим улыбается и почти всегда в одном ракурсе и хорошем свете.
Но мы будем осуществлять детекцию когда он играет в видео кадре, например в шоу трумена у него кадов с улыбкой значительно меньше, чем обычных эмоций.

- Для более точной детекции необходимо обогатить базу с разными фильмами с Джимом и вырезать фотографии из видео ряда с разными ракурсами, освещенностями и тд.

- Так же важно не перенасытить базу, что бы нейронка не реагировала на любое лицо как на Джима Керри.

# **Повышение шансов на победу - ЛайфХак**
- Часть конкурса составляет текущий видео ролик и хронометраж Джима в выданном отрезке.
Чтобы повысить шансы модели на определение лица Джима в текущем ролике и более корректно его посчитать, я могу выделить по 2-3 лица из разных сцен ролика и загрузить их в модель для обучения.
Это ухищрение позволит сделать данную часть задания более точно.
